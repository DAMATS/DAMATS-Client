/* D3.TimeSlider - version 0.0.23 - 2016-07-19
 * See https://github.com/EOX-A/d3.TimeSlider for more information! */
(function(){var a,b=[].slice;a=function(){function a(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=this;for(this.element=a,this.options=null!=b?b:{},this.debug=!1,this.brush_tooltip=!0,this.brush_tooltip_offset=[-30,20],this.time_tooltip=!0,this.time_tooltip_is_on=!0,this.time_tooltip_offset=[-30,-35],this.tooltip=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),this.tooltip_time=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),this.tooltip_brush_min=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),this.tooltip_brush_max=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),this.bbox=null,this.svg=d3.select(a).append("svg").attr("class","timeslider"),this.useBBox=!1,0===this.svg[0][0].clientWidth&&(d3.select(a).select("svg").append("rect").attr("width","100%").attr("height","100%").attr("opacity","0"),this.useBBox=!0),this.options.width=this.useBBox?this.svg[0][0].getBBox().width:this.options.width=this.svg[0][0].clientWidth,this.options.height=this.useBBox?this.svg[0][0].getBBox().height:this.svg[0][0].clientHeight,(m=this.options).brush||(m.brush={}),(n=this.options.brush).start||(n.start=this.options.start),(o=this.options.brush).end||(o.end=new Date(new Date(this.options.brush.start).setDate(this.options.brush.start.getDate()+3))),(p=this.options).debounce||(p.debounce=50),(q=this.options).ticksize||(q.ticksize=3),(r=this.options).selectionLimit||(r.selectionLimit=-1),(s=this.options).timeFormatStr||(s.timeFormatStr="%Y-%m-%d %H:%M:%S"),(t=this.options).timeTickDate||(t.timeTickDate=null),(u=this.options).minBrushSize||(u.minBrushSize=1),null!=this.options.brushTooltip&&(this.brush_tooltip=this.options.brushTooltip),null!=this.options.brushTooltipOffset&&(this.brush_tooltip_offset=this.options.brushTooltipOffset),null!=this.options.timeTooltip&&(this.time_tooltip=this.options.timeTooltip),null!=this.options.timeTooltipOffset&&(this.time_tooltip_offset=this.options.timeTooltipOffset),this.data={},this.timeTickDate=this.options.timeTickDate,this.timeFormat=d3.time.format.utc(this.options.timeFormatStr),this.timeouts=[],e=function(a,b,c){return a&&b&&c?(A.timeouts[b]||(A.timeouts[b]=-1),function(){return A.timeouts[b]>-1&&window.clearTimeout(A.timeouts[b]),A.timeouts[b]=window.setTimeout(c,a)}):void 0},c=d3.time.format.utc.multi([["%S.%L",function(a){return a.getUTCMilliseconds()}],["%M:%S",function(a){return a.getUTCSeconds()}],["%H:%M",function(a){return a.getUTCMinutes()}],["%H:%M",function(a){return a.getUTCHours()}],["%b %d",function(a){return a.getUTCDay()&&1!==a.getUTCDate()}],["%b %d",function(a){return 1!==a.getUTCDate()}],["%b",function(a){return a.getUTCMonth()}],["%Y",function(){return!0}]]),this.scales={x:d3.time.scale.utc().domain([this.options.domain.start,this.options.domain.end]).range([0,this.options.width]).nice(),y:d3.scale.linear().range([this.options.height-29,0])},this.axis={x:d3.svg.axis().scale(this.scales.x).innerTickSize(this.options.height-15).tickFormat(c),y:d3.svg.axis().scale(this.scales.y).orient("left")},this.svg.append("g").attr("class","mainaxis").call(this.axis.x),d3.select(this.element).select("g.mainaxis .domain").attr("transform","translate(0, "+(b.height-18)+")"),(v=this.options).brushEnabled||(v.brushEnabled=!0),this.brush_enabled=this.options.brushEnabled,this.brushExtent=[this.options.brush.start,this.options.brush.end],this.redrawBrush=function(a){var b,c,d;return null!=a&&(this.brushExtent=a),a=this.brushExtent,this.brush_enabled?(c=[this.scales.x(a[0]),this.scales.x(a[1])],d=this.options.minBrushSize,c[1]-c[0]<d&&(b=.5*(c[1]+c[0]),a=[this.scales.x.invert(b-.5*d),this.scales.x.invert(b+.5*d)])):a=[a[0],a[0]],this.brush.x(this.scales.x).extent(a),d3.select(this.element).select("g.brush").call(this.brush)},this.brush=d3.svg.brush().x(this.scales.x).on("brushstart",function(){return A.time_tooltip_is_on=!1,A.options.lastZoom={scale:A.options.zoom.scale(),translate:[A.options.zoom.translate()[0],A.options.zoom.translate()[1]]},A.options.zoom.on("zoom",null)}).on("brushend",function(){var a;return A.time_tooltip_is_on=!0,A.options.zoom.scale(A.options.lastZoom.scale).translate(A.options.lastZoom.translate).on("zoom",A.redraw),a=A.brush.extent(),A.brush_enabled?(A.options.selectionLimit>0&&(A.svg.selectAll(".brush").attr({fill:"#333"}),(a[1]-a[0])/1e3>=A.options.selectionLimit&&(a=[a[0],new Date(a[0].getTime()+1e3*A.options.selectionLimit)],A.brush.extent(a),d3.select(A.element).select("g.brush").call(A.brush))),A.brushExtent=a,A.element.dispatchEvent(new CustomEvent("selectionChanged",{detail:{start:a[0],end:a[1]},bubbles:!0,cancelable:!0}))):(A.brush.extent([a[0],a[0]]),d3.select(A.element).select("g.brush").call(A.brush)),A.brush_tooltip?(A.tooltip_brush_min.transition().duration(100).style("opacity",0),A.tooltip_brush_max.transition().duration(100).style("opacity",0)):void 0}).on("brush",function(){var a,b,c,d,e,f,g;return A.options.zoom.scale(A.options.lastZoom.scale).translate(A.options.lastZoom.translate),a=A.brush.extent(),A.options.selectionLimit>0&&((a[1]-a[0])/1e3>A.options.selectionLimit?A.svg.selectAll(".brush").attr({fill:"red"}):A.svg.selectAll(".brush").attr("class","brush brush-ok").attr({fill:"#333"})),A.brush_tooltip?(e=0,c=A.svg[0][0],b=null!=c.parentElement?c.parentElement.offsetHeight:c.parentNode.offsetHeight,d=c.getBoundingClientRect(),f=A.brush_tooltip_offset[0]+d.left,g=A.brush_tooltip_offset[1]+d.top,A.tooltip_brush_min.transition().duration(100).style("opacity",.9),A.tooltip_brush_min.html(A.timeFormat(a[0])).style("left",A.scales.x(a[0])+f+"px").style("top",g+"px"),A.tooltip_brush_max.transition().duration(100).style("opacity",.9),A.tooltip_brush_max.html(A.timeFormat(a[1])).style("left",A.scales.x(a[1])+f+"px").style("top",g+20+"px")):void 0}),this.svg.append("g").attr("class","brush").call(this.brush).selectAll("rect").attr("height",""+(this.options.height-19)).attr("y",0),this.svg.append("g").attr("class","datasets").attr("width",this.options.width).attr("height",this.options.height).attr("transform","translate(0, "+(b.height-23)+")"),this.drawDataset=function(a){var b,c;return null==A.options.datasetIndex&&(A.options.datasetIndex=0),null==A.options.linegraphIndex&&(A.options.linegraphIndex=0),b=A.options.datasetIndex,c=!1,a.lineplot?(b=A.options.linegraphIndex++,c=!0,A.svg.select("g.datasets").append("g").attr("class","dataset").attr("id","dataset-"+a.id)):(b=A.options.datasetIndex++,A.svg.select("g.datasets").insert("g",":first-child").attr("class","dataset").attr("id","dataset-"+a.id)),A.data[a.id]={index:b,color:a.color,callback:a.data,points:[],ranges:[],lineplot:c},A.reloadDataset(a.id)},this.updateDataset=function(a){var b,c,d,e;return c=A.svg.select("g.datasets #dataset-"+a),b=A.data[a],d=b.ranges.filter(function(a){return A.scales.x(new Date(a[1]))-A.scales.x(new Date(a[0]))<5}),e=b.ranges.filter(function(a){return A.scales.x(new Date(a[1]))-A.scales.x(new Date(a[0]))>=5}),b.paths&&b.paths.length>0?f(c,b.paths,{index:b.index,color:b.color}):(h(c,e,{index:b.index,color:b.color}),g(c,d.concat(b.points),{index:b.index,color:b.color}))},this.setTimetick=function(a){return A.timeTickDate=a,i()},i=function(){var a;return A.svg.selectAll(".timetick").remove(),"[object Date]"===Object.prototype.toString.call(A.timeTickDate)?(a=A.svg.selectAll(".timetick").data([A.timeTickDate]),a.enter().append("rect").attr("class","timetick").attr("x",function(a){return A.scales.x(a)}).attr("y",0).attr("width",function(a){return 1}).attr("height",A.options.height-20).attr("stroke","red").attr("stroke-width",1).attr("fill",function(a){return b.color}),a.exit().remove()):void 0},h=function(a,b,c){var d;return a.selectAll("rect").remove(),d=a.selectAll("rect").data(b),d.enter().append("rect").attr("x",function(a){return A.scales.x(new Date(a[0]))}).attr("y",-(A.options.ticksize+3)*c.index+-(A.options.ticksize-2)).attr("width",function(a){return A.scales.x(new Date(a[1]))-A.scales.x(new Date(a[0]))}).attr("height",A.options.ticksize-2).attr("stroke",d3.rgb(c.color).darker()).attr("stroke-width",1).attr("fill",function(a){return a[4]===!1?"transparent":c.color}).on("mouseover",function(a){return a[2]?(A.time_tooltip_is_on=!1,A.tooltip.transition().duration(100).style("opacity",.9),A.tooltip.html(a[2]).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")):void 0}).on("mousemove",function(a){return A.tooltip.style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(a){return A.time_tooltip_is_on=!0,A.tooltip.transition().duration(100).style("opacity",0)}).on("click",function(a){return A.element.dispatchEvent(new CustomEvent("coverageselected",{detail:{id:a[2],bbox:a[3],start:a[0],end:a[1]},bubbles:!0,cancelable:!0}))}),d.exit().remove()},g=function(a,b,c){var d;return a.selectAll("circle").remove(),d=a.selectAll("circle").data(b),d.enter().append("circle").attr("cx",function(a){return Array.isArray(a)?A.scales.x(new Date(a[0])):A.scales.x(new Date(a))}).attr("cy",-(A.options.ticksize+3)*c.index+-(A.options.ticksize-2)/2).attr("fill",function(a){return a[4]===!1?"transparent":c.color}).attr("stroke",d3.rgb(c.color).darker()).attr("stroke-width",1).attr("r",A.options.ticksize/2).on("mouseover",function(a){return a[2]?(A.time_tooltip_is_on=!1,A.tooltip.transition().duration(100).style("opacity",.9),A.tooltip.html(a[2]).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")):void 0}).on("mousemove",function(a){return A.tooltip.style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(a){return A.time_tooltip_is_on=!0,A.tooltip.transition().duration(100).style("opacity",0)}).on("click",function(a){return A.element.dispatchEvent(new CustomEvent("coverageselected",{detail:{id:a[2],bbox:a[3],start:a[0],end:a[1]},bubbles:!0,cancelable:!0}))}),d.exit().remove()},f=function(a,b,c){var d,e;return A.scales.y.domain(d3.extent(b,function(a){return a[1]})),a.selectAll("path").remove(),a.selectAll(".y.axis").remove(),d=d3.svg.line().x(function(a){return A.scales.x(new Date(a[0]))}).y(function(a){return A.scales.y(a[1])}),a.append("path").datum(b).attr("class","line").attr("d",d).attr("stroke",c.color).attr("stroke-width","1.5px").attr("fill","none").attr("transform","translate(0,"+(-A.options.height+29)+")"),e=(A.scales.y.domain()[1]-A.scales.y.domain()[0])/4,A.axis.y.tickValues(d3.range(A.scales.y.domain()[0],A.scales.y.domain()[1]+e,e)),a.append("g").attr("class","y axis").attr("fill",c.color).call(A.axis.y).attr("transform","translate("+30*(c.index+1)+","+(-A.options.height+29)+")"),a.selectAll(".axis .domain").attr("stroke-width","1").attr("stroke",c.color).attr("shape-rendering","crispEdges").attr("fill","none"),a.selectAll(".axis line").attr("stroke-width","1").attr("shape-rendering","crispEdges").attr("stroke",c.color),a.selectAll(".axis path").attr("stroke-width","1").attr("shape-rendering","crispEdges").attr("stroke",c.color)},this.reloadDataset=function(b){var c;return(c=e(A.options.debounce,b,function(){return A.data[b].callback(A.scales.x.domain()[0],A.scales.x.domain()[1],function(b,c){var d,e,f,g,h,i,j;for(d=A.svg.select("g.datasets #dataset-"+b),h=[],g=[],f=[],i=0,j=c.length;j>i;i++)a=c[i],Array.isArray(a)?3===a.length?f.push(a):h.push(a):!(a instanceof Date)&&a.split("/").length>1?(e=a.split("/"),e.pop(),h.push(e)):g.push(a);return A.data[b].ranges=h,A.data[b].points=g,A.data[b].paths=f,A.updateDataset(b)},A.bbox)}))()},z=this.options.datasets,w=function(a){return A.drawDataset(a)},x=0,y=z.length;y>x;x++)d=z[x],w(d);this.redraw=function(){d3.select(A.element).select("g.mainaxis").call(A.axis.x).selectAll("text").attr("x",1).style("text-anchor","start"),A.redrawBrush();for(d in A.data)A.data[d].lineplot||(A.reloadDataset(d),A.updateDataset(d));for(d in A.data)A.data[d].lineplot&&(A.reloadDataset(d),A.updateDataset(d));return i()},k=function(){var a;return a=d3.select(A.element).select("svg.timeslider")[0][0],A.options.width=A.useBBox?a.getBBox().width:a.clientWidth,A.scales.x.range([0,A.options.width]),A.redraw()},d3.select(window).on("resize",k),this.options.zoom=d3.behavior.zoom().x(this.scales.x).size([this.options.width,this.options.height]).scaleExtent([1,1/0]).on("zoom",this.redraw),this.svg.call(this.options.zoom),this.options.display&&this.center(this.options.display.start,this.options.display.end),j=function(){return A.tooltip_time.transition().duration(100).style("opacity",0)},l=function(a){var b,c,d,e,f,g;return A.time_tooltip&&A.time_tooltip_is_on?(c=A.svg[0][0],g=null!=c.parentElement?c.parentElement:c.parentNone,b=d3.mouse(c),d=c.getBoundingClientRect(),e=A.time_tooltip_offset[0]+d.left,f=A.time_tooltip_offset[1]+d.top,A.tooltip_time.transition().duration(100).style("opacity",.9),A.tooltip_time.html(A.timeFormat(A.scales.x.invert(b[0]))).style("left",e+b[0]+"px").style("top",f+b[1]+"px")):j()},this.svg.on("mousemove",l).on("mouseout",j)}return function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}a.prototype=window.Event.prototype,window.CustomEvent=a}(),a.prototype.setBrush=function(a){return this.brush_enabled=a},a.prototype.setBrushTooltip=function(a){return this.brush_tooltip=a},a.prototype.setBrushTooltipOffset=function(a){return this.brush_tooltip_offset=a},a.prototype.setTimeTooltip=function(a){return this.time_tooltip=a},a.prototype.setTimeTooltipOffset=function(a){return this.time_tooltip_offset=a},a.prototype.hide=function(){return console.log("hide"),this.originalDisplay=this.element.style.display,this.element.style.display="none",!0},a.prototype.show=function(){return console.log("show"),this.element.style.display=this.originalDisplay,this.redraw(),!0},a.prototype.domain=function(){var a,c,d,e;return c=1<=arguments.length?b.call(arguments,0):[],2!==c.length?!1:(d=new Date(c[0]),a=new Date(c[1]),d>a&&(e=[a,d],d=e[0],a=e[1]),this.options.domain.start=d,this.options.domain.end=a,this.scales.x.domain([this.options.domain.start,this.options.domain.end]),this.redraw(),!0)},a.prototype.select=function(){var a,c,d,e;return c=1<=arguments.length?b.call(arguments,0):[],2!==c.length?!1:(d=new Date(c[0]),a=new Date(c[1]),d>a&&(e=[a,d],d=e[0],a=e[1]),d<this.options.start&&(d=this.options.start),a>this.options.end&&(a=this.options.end),this.brushExtent=[d,a],this.redrawBrush(),this.element.dispatchEvent(new CustomEvent("selectionChanged",{detail:{start:d,end:a},bubbles:!0,cancelable:!0})),!0)},a.prototype.addDataset=function(a){return this.drawDataset(a),!0},a.prototype.removeDataset=function(a){var b,c,d;if(null==this.data[a])return!1;c=this.data[a].index,d=this.data[a].lineplot,delete this.data[a],d?this.options.linegraphIndex--:this.options.datasetIndex--,d3.select(this.element).select("g.dataset#dataset-"+a).remove();for(b in this.data)d===this.data[b].lineplot&&this.data[b].index>c&&(this.data[b].index-=1);return this.redraw(),!0},a.prototype.center=function(){var a,c,d,e;return c=1<=arguments.length?b.call(arguments,0):[],d=new Date(c[0]),a=new Date(c[1]),d>a&&(e=[a,d],d=e[0],a=e[1]),this.options.zoom.scale((this.options.domain.end-this.options.domain.start)/(a-d)),this.options.zoom.translate([this.options.zoom.translate()[0]-this.scales.x(d),0]),this.redraw(),!0},a.prototype.zoom=function(){var a,c,d,e,f=this;return c=1<=arguments.length?b.call(arguments,0):[],d=new Date(c[0]),a=new Date(c[1]),d>a&&(e=[a,d],d=e[0],a=e[1]),d3.transition().duration(750).tween("zoom",function(){var b;return b=d3.interpolate(f.options.zoom.scale(),(f.options.domain.end-f.options.domain.start)/(a-d)),function(a){var c;return c=d3.interpolate(f.options.zoom.translate()[0],f.options.zoom.translate()[0]-f.scales.x(d)),f.options.zoom.scale(b(a)),f.options.zoom.translate([c(a),0]),f.redraw()}}),!0},a.prototype.reset=function(){return this.zoom(this.options.domain.start,this.options.domain.end),!0},a.prototype.updateBBox=function(a,b){return null==this.data[b]?!1:(this.bbox=a,this.reloadDataset(b),!0)},a}(),a.Plugin=function(){function a(){}return a}(),this.TimeSlider=a}).call(this);